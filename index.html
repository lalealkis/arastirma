<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Onay Gerekli</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            background-color: #f4f7f6;
            color: #333;
            line-height: 1.6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .form-container { /* Renamed from confirmation-box */
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-width: 600px;
            width: 100%; /* Make container responsive */
            box-sizing: border-box; /* Include padding */
            text-align: left;
        }
        .form-container h1 {
            color: #0056b3; /* Changed color from red */
            margin-top: 0;
            margin-bottom: 20px;
        }
         .form-container > p { /* Style for paragraphs directly under container */
            margin-bottom: 25px;
            font-size: 1.1em;
         }

        /*.data-form { /* Renamed from confirmation-form */
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
             text-align: left; /* Align form elements left */
        }
	*/
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .form-group input[type="text"],
        .form-group input[type="date"],
        .form-group select { /* Apply styles to text, date inputs and selects */
            width: calc(100% - 22px); /* Adjust for padding and border */
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
            box-sizing: border-box; /* Include padding and border in width */
            /* Added display block for selects for better layout */
             display: block;
             max-width: 100%; /* Ensure they don't overflow */
		border-color: #dc3545;
    		box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }

         /* Specific width for date input if needed, or let it be full width */
         /* .form-group input[type="date"] { width: auto; } */


        /* Style for input when it's required and invalid */
        .form-group input:required:invalid:not(:placeholder-shown),
        .form-group select:required:invalid:not([value=""]), /* Added select validation */
        .form-group input:required:invalid:focus,
        .form-group select:required:invalid:focus {
            border-color: #dc3545; /* Red border for invalid */
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }
         /* Style for input when it's valid */
        .form-group input:valid:not(:placeholder-shown),
        .form-group select:valid:not([value=""]) { /* Added select validation */
            border-color: #28a745; /* Green border for valid */
             box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
        }

        /* Initially hide the conditional text input container */
        .conditional-input-container {
            display: none;
             margin-top: 15px; /* Space above the conditional input */
        }
         .conditional-input-container label {
             font-weight: normal; /* Less emphasis for the details label */
             margin-bottom: 5px;
         }


        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px; /* Space above buttons */
        }
        .confirm-button, .cancel-button {
            display: inline-block;
            padding: 12px 25px;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            transition: background-color 0.3s ease, opacity 0.3s ease;
             cursor: pointer;
             border: none;
             font-size: 1em;
        }
        .confirm-button {
            background-color: #28a745; /* Green */
            color: white;
        }
         /* Style for the disabled button state */
        .confirm-button:disabled {
            background-color: #ccc; /* Greyed out */
            cursor: not-allowed;
            opacity: 0.7;
        }

        .confirm-button:not(:disabled):hover { /* Apply hover only when NOT disabled */
            background-color: #218838;
        }

        .cancel-button {
            background-color: #6c757d; /* Grey */
            color: white;
        }
        .cancel-button:hover {
            background-color: #5a6268;
        }
         .confirm-button:active, .cancel-button:active {
             opacity: 0.8;
         }

        /* Optional: Style for required asterisk */
        .form-group label::after {
            content: '*';
            color: red;
            margin-left: 4px;
        }
		
		#longForm {
            overflow-y: scroll;
            height: 500px;
            margin: 5px;
            padding-bottom: 15px;
        }


    </style>
</head>
<body>

    <div class="form-container"> <!-- Renamed container class -->
        <div id="longForm">
            <h3>BİLGİLENDİRİLMİŞ GÖNÜLLÜ OLUR FORMU</h3>
            <h4>ÇALIŞMANIN ADI:</h4> <p>İnhibisyon Yeteneği İle Yönlendirilmiş Unutma Düzeyi Arasında Bir İlişki Var mıdır?</p>
            <p>Aşağıda bilgileri yer almakta olan bir araştırma çalışmasına katılmanız istenmektedir. Çalışmaya katılıp katılmama kararı tamamen size aittir. Katılmak isteyip istemediğinize karar vermeden önce araştırmanın neden yapıldığını, bilgilerinizin nasıl kullanılacağını, çalışmanın neleri içerdiğini,  olası yararları ve risklerini ya da rahatsızlık verebilecek yönlerini anlamanız önemlidir. Lütfen aşağıdaki bilgileri dikkatlice okumak için zaman ayırınız. Eğer çalışmaya katılma kararı verirseniz, Çalışmaya Katılma Onayı Formu’nu imzalayınız. Çalışmadan herhangi bir zamanda ayrılmakta özgürsünüz. Araştırmada kullanılacak tüm malzemeler ve yapılabilecek tüm harcamalar araştırmacı tarafından karşılanacaktır.</p>
            <h4>ÇALIŞMANIN KONUSU VE AMACI:</h4> <p>Bu çalışma, Üsküdar Üniversitesi'nde doktora tezi kapsamında yürütülecek deneysel bir araştırmadır. Bu araştırmanın amacı, bireylerin inhibisyon yeteneği ile yönlendirilmiş unutma düzeyleri arasındaki ilişkinin deneysel yöntemlerle incelenmesidir.</p>
            <h4>ÇALIŞMA İŞLEMLERİ:</h4> <p>Araştırma kapsamında katılımcılara aşağıdaki psikolojik testler uygulanacaktır: Stroop Testi, İz Sürme Testi (Trail Making Test), Yönlendirilmiş Unutma Görevi.
Bu testlerin uygulanması yaklaşık olarak 25–30 dakika sürecektir. Tüm uygulamalar bireysel olarak, uygun ve güvenli bir ortamda gerçekleştirilecektir.
</p>
            <h4>ÇALIŞMAYA KATILMAMIN OLASI YARARLARI NELERDİR? </h4> <p>Araştırmaya katılım sonucunda doğrudan bir yarar sağlanmayabilir, ancak çalışma psikoloji bilim alanına katkıda bulunacaktır.</p>
            <h4>KİŞİSEL BİLGİLERİM NASIL KULLANILACAK?</h4> <p>Katılımcılardan elde edilen tüm bilgiler gizli tutulacak ve yalnızca bilimsel amaçla kullanılacaktır. Kişisel kimlik bilgileri hiçbir şekilde üçüncü kişilerle paylaşılmayacaktır. Veriler analiz edilirken katılımcılar anonimleştirilmiş şekilde tanımlanacaktır. Bu araştırmanın katılımcılar için bilinen herhangi bir fiziksel ya da psikolojik riski bulunmamaktadır. </p>
            <h4>SORU VE PROBLEMLER İÇİN BAŞVURULACAK KİŞİLER :</h4> <p>1.	Araştırmacı: Uzman Klinik Psikolog Lale ALKIŞ Üsküdar Üniversitesi, [Sosyal Bilimler Fakültesi], [Psikoloji], Doktora Öğrencisi</p> <p>2.	Danışman: Prof. Dr. Hıdır İlyas GÖZ Üsküdar Üniversitesi Öğretim Üyesi, Psikoloji Doktora Bölüm Başkanı</p>
            <h3>Çalışmaya Katılma Onayı</h3> <p>Bu araştırmaya dair yukarıda belirtilen bilgileri okudum ve anladım Yukarıdaki bilgileri ilgili araştırmacı ile ayrıntılı olarak tartıştım ve kendisi bütün sorularımı cevapladı. Bu bilgilendirilmiş olur belgesini okudum ve anladım. Katılımımın gönüllü olduğunu, istediğim zaman herhangi bir gerekçe göstermeksizin çalışmadan çekilebileceğimi biliyorum. Bu araştırmaya katılmayı kabul ediyor ve bu onay belgesini kendi hür irademle imzalıyorum. Bu onay, ilgili hiçbir kanun ve yönetmeliği geçersiz kılmaz. Katılımcı onam formunun bir örneğini talep edebileceğim bilgisi tarafıma verildi. Gönüllü olarak katılmayı kabul ediyorum.</p>
        </div>
        <form id="dataForm" class="data-form"> <!-- Renamed form ID and class -->
            <div class="form-group">
				<h3 style="text-align: left;">KİŞİSEL BİLGİ FORMU</h3>
                <label for="userName" style="margin-top: 15px;">Ad-Soyad:</label>
                <input type="text" id="userName" name="userName" required autocomplete="off">
            </div>

             <div class="form-group">
                <label for="telNumber">Telefon Numarası:</label>
                <input type="text" id="telNumber" name="telNumber" required placeholder="örn: +90-123-456-7890, 123-456-7890" autocomplete="off">
            </div>

            <div class="form-group">
                <label for="birthDate">Doğum Tarihi:</label>
                <input type="date" id="birthDate" name="birthDate" required> <!-- Made date required -->
            </div>

            <div class="form-group">
                <label for="sex">Cinsiyet:</label>
                <select id="sex" name="sex" required> <!-- Made sex required -->
                    <option value="">Seçiniz...</option>
                    <option value="Erkek">Erkek</option>
                    <option value="Kadın">Kadın</option>
                </select>
            </div>

             <div class="form-group">
                <label for="question1">Son iki ayda herhangi bir psikiyatrik veya psikolojik tedavi gördünüz mü?</label>
                <select id="question1" name="question1" required> <!-- Made required -->
                    <option value="">Seçiniz...</option>
                    <option value="Evet">Evet</option>
                    <option value="Hayır">Hayır</option>
                </select>

                <!-- Conditional Input Container -->
                <div id="conditionalInputContainer" class="conditional-input-container">
                    <label for="question1Details">Yukarıdaki soruya cevabınız “Evet” ise bu tedaviler gereği herhangi bir ilaç kullandınız mı yazınız:</label>
                    <input type="text" id="question1Details" name="question1Details" autocomplete="off"> <!-- 'required' handled by JS -->
                </div>
            </div>

            <div class="form-group">
                <label for="question2">Renk körlüğü ya da görme bozukluğunuz (gözlük kullanımı dahil değildir) var mı?:</label>
                <select id="question2" name="question2" required> <!-- Made required -->
                    <option value="">Seçiniz...</option>
                    <option value="Evet">Evet</option>
                    <option value="Hayır">Hayır</option>
                </select>
            </div>


             <div class="button-container">
                 <!-- Button starts disabled -->
                 <button type="submit" class="confirm-button" id="proceedButton" style="margin-top: 20px;" disabled>Anladım ve Devam Etmek İstiyorum</button>
             </div>
        </form>
    </div>

    <script>
	    const urlParams = new URLSearchParams(window.location.search);
        const targetPage = "/experiments-homepage/home.html"

        const dataForm = document.getElementById('dataForm'); // Renamed form reference
        const proceedButton = document.getElementById('proceedButton');
        const userNameInput = document.getElementById('userName');
        const telNumberInput = document.getElementById('telNumber');
        const birthDateInput = document.getElementById('birthDate'); // Get date input
        const sexSelect = document.getElementById('sex'); // Get sex dropdown
        const question1Select = document.getElementById('question1');
        const conditionalInputContainer = document.getElementById('conditionalInputContainer');
        const question1DetailsInput = document.getElementById('question1Details');
        const question2Select = document.getElementById('question2'); // Get second question dropdown


        // Function to check if the form is valid (ALL required fields filled)
        function checkFormValidity() {
            // Check if name is filled
            const isNameFilled = userNameInput.value.trim() !== '';

            // Check if telephone is valid (not empty and >= 10 digits)
            const cleanedTelValue = telNumberInput.value.replace(/[^\d+]/g, '');
            const digitCount = cleanedTelValue.replace(/\+/g, '').length;
            const isTelValid = telNumberInput.value.trim() !== '' && digitCount >= 10;

            // Check if date is filled
            const isBirthDateFilled = birthDateInput.value !== '';

            // Check if sex is selected (value is not the default empty option)
            const isSexSelected = sexSelect.value !== '';

             // Check if Question 1 is answered
            const isQuestion1Answered = question1Select.value !== '';

            // Check if Question 2 is answered
            const isQuestion2Answered = question2Select.value !== '';


            // Check if Question 1 Details are required and filled
            let isQuestion1DetailsValid = true; // Assume valid unless required and empty
            if (question1Select.value === 'Evet') {
                // If "Yes" is selected, the details field must be filled
                isQuestion1DetailsValid = question1DetailsInput.value.trim() !== '';
            }
            // If question1Select.value is "no" or "", isQuestion1DetailsValid remains true


            // Button is enabled ONLY if ALL required conditions are met
            return isNameFilled && isTelValid && isBirthDateFilled && isSexSelected && isQuestion1Answered && isQuestion2Answered && isQuestion1DetailsValid;
        }

        // --- Auto-formatting for telephone number ---
        telNumberInput.addEventListener('input', function() {
            let value = telNumberInput.value;
            const oldValueLength = value.length;
            const oldCursorPosition = telNumberInput.selectionStart;

            // Remove non-digits, but allow a leading '+'
            let cleanedValue = value.replace(/[^\d+]/g, '');
            if (cleanedValue.startsWith('+') && cleanedValue.length > 0) {
                 cleanedValue = '+' + cleanedValue.substring(1).replace(/\D/g, ''); // Keep the first +, remove other non-digits
            } else {
                 cleanedValue = cleanedValue.replace(/\D/g, ''); // Remove all non-digits if no leading +
            }


            let formattedValue = '';
            let tempDigits = cleanedValue.replace(/\+/g, ''); // Get digits only

            if (cleanedValue.startsWith('+')) {
                formattedValue += '+';
            }


            if (tempDigits.length > 0 &&  formattedValue !== "+") {
                formattedValue += tempDigits.substring(0, Math.min(3, tempDigits.length));
                if (tempDigits.length > 3) {
                    formattedValue += '-';
                    formattedValue += tempDigits.substring(3, Math.min(6, tempDigits.length));
                    if (tempDigits.length > 6) {
                         formattedValue += '-';
                         formattedValue += tempDigits.substring(6, Math.min(10, tempDigits.length));
                         // Stop after 10 digits for basic formatting
                    }
                }
            }
			else {
				formattedValue += tempDigits.substring(0, Math.min(2, tempDigits.length));
                if (tempDigits.length > 2) {
                    formattedValue += '-';
                    formattedValue += tempDigits.substring(2, Math.min(5, tempDigits.length));
                    if (tempDigits.length > 5) {
                        formattedValue += '-';
                        formattedValue += tempDigits.substring(5, Math.min(8, tempDigits.length));
                        if (tempDigits.length > 8) {
                        formattedValue += '-';
                        formattedValue += tempDigits.substring(8, Math.min(12, tempDigits.length));
						}
                    }
                }
			}
			

            telNumberInput.value = formattedValue;

             // --- Restore Cursor Position ---
             // This is a simplified attempt and might not be perfect in all cases
            const newValueLength = telNumberInput.value.length;
            const lengthDiff = newValueLength - oldValueLength;
            const newCursorPosition = oldCursorPosition + lengthDiff;

            // Adjust cursor position if it landed inside a newly added dash
            if (lengthDiff > 0 && newCursorPosition > 0) {
                 // Check if the character *before* the new cursor position is a dash
                 // and the old cursor position was *before* where the dash was added
                if (telNumberInput.value[newCursorPosition - 1] === '-' && oldCursorPosition <= (newCursorPosition - 1 - lengthDiff) ) {
                     telNumberInput.setSelectionRange(newCursorPosition + 1, newCursorPosition + 1);
                } else {
                     telNumberInput.setSelectionRange(newCursorPosition, newCursorPosition);
                }
            } else {
                telNumberInput.setSelectionRange(newCursorPosition, newCursorPosition);
            }


            // --- Update Button State After Formatting ---
            proceedButton.disabled = !checkFormValidity();
        });


         // --- Conditional Input Display ---
        question1Select.addEventListener('change', function() {
            if (question1Select.value === 'Evet') {
                conditionalInputContainer.style.display = 'block';
                // Make the details input required if visible AND name/phone/other required fields are filled
                // To simplify, we just make it required. checkFormValidity handles the rest.
                 question1DetailsInput.required = true;
            } else {
                conditionalInputContainer.style.display = 'none';
                question1DetailsInput.value = ''; // Clear value when hidden
                question1DetailsInput.required = false; // Remove required status
            }
             // Also check button validity when this changes
             proceedButton.disabled = !checkFormValidity();
        });


        // --- Event Listeners for New Fields (Trigger Validation Check) ---
        birthDateInput.addEventListener('input', function() {
             proceedButton.disabled = !checkFormValidity();
        });

        sexSelect.addEventListener('change', function() {
             proceedButton.disabled = !checkFormValidity();
        });

        // question1Select change listener is already above for conditional input

        question2Select.addEventListener('change', function() {
             proceedButton.disabled = !checkFormValidity();
        });

         // Also listen to input on the conditional details field if it's visible
         question1DetailsInput.addEventListener('input', function() {
             // Only check validity if the container is displayed (means question1 is 'yes')
            if (conditionalInputContainer.style.display !== 'none') {
                 proceedButton.disabled = !checkFormValidity();
            }
         });



        // --- Initial State and Form Submission ---
        // Disable the button initially (also set in HTML)
        proceedButton.disabled = true;


        // If a target page is found (expecting this page is linked TO)
        if (targetPage) {

            // Add event listener to the name input field
            userNameInput.addEventListener('input', function() {
                proceedButton.disabled = !checkFormValidity();
            });

            // The telNumberInput listener is already defined above for formatting and validation

            // Add submit listener to the form
            dataForm.addEventListener('submit', function(event) { // Renamed form reference
                // Only proceed if the form is valid (button should already be enabled)
                if (!checkFormValidity()) {
                    event.preventDefault();
                    return;
                }

                event.preventDefault(); // Prevent the default form submission

                // Collect form data from ALL fields with a 'name' attribute
                const formData = new FormData(dataForm); // Renamed form reference
                const dataToStore = {};
                formData.forEach((value, key) => {
                    // Exclude the details input if the answer was 'no'
                     if (key === 'question1Details' && question1Select.value !== 'Evet') {
                         // Skip this field
                     } else {
                         dataToStore[key] = value;
                     }

                });

                // Store data in sessionStorage as a JSON string
                sessionStorage.setItem('confirmationFormData', JSON.stringify(dataToStore));
		    //sessionStorage.setItem('isListOrderSwapped', JSON.stringify({"value":false}));

                // Redirect to the target page
                window.location.href = targetPage;

            });

            // Check validity on page load in case fields are pre-filled by the browser
            checkFormValidity(); // Call once to set initial button state
            proceedButton.disabled = !checkFormValidity();

            // Trigger change event on question1Select to set initial visibility of conditional input
            question1Select.dispatchEvent(new Event('change'));


        } else {
             // If no target is specified (e.g., user opened index.html directly without a target)
             // You might want a default behavior here, or show a message.
             // For now, we'll just allow the form to be filled but submission won't redirect.
             console.warn("No target page specified in the URL. Form submission will not redirect.");
             // You could also disable the form or show a message to the user.
             // Example: Disable the submit button permanently and show a message
             proceedButton.disabled = true;
             proceedButton.textContent = 'Cannot Proceed (No Target)';
             proceedButton.style.backgroundColor = '#ccc';
             proceedButton.style.cursor = 'not-allowed';
             const noTargetMsg = document.createElement('p');
             noTargetMsg.style.color = 'orange';
             noTargetMsg.textContent = 'Warning: No destination specified. Form data will not be saved.';
              dataForm.insertBefore(noTargetMsg, dataForm.firstChild); // Add message inside form

             // Still need listeners to enable/disable button based on validation, even if submit does nothing
              userNameInput.addEventListener('input', function() { proceedButton.disabled = !checkFormValidity(); });
              telNumberInput.addEventListener('input', function() { proceedButton.disabled = !checkFormValidity(); });
              birthDateInput.addEventListener('input', function() { proceedButton.disabled = !checkFormValidity(); });
              sexSelect.addEventListener('change', function() { proceedButton.disabled = !checkFormValidity(); });
              question1Select.addEventListener('change', function() {
                 if (question1Select.value === 'yes') {
                    conditionalInputContainer.style.display = 'block';
                 } else {
                    conditionalInputContainer.style.display = 'none';
                    question1DetailsInput.value = '';
                 }
                 proceedButton.disabled = !checkFormValidity();
              });
               question2Select.addEventListener('change', function() { proceedButton.disabled = !checkFormValidity(); });
               question1DetailsInput.addEventListener('input', function() {
                   if (conditionalInputContainer.style.display !== 'none') {
                     proceedButton.disabled = !checkFormValidity();
                   }
               });
               // Initial check
               checkFormValidity();
               proceedButton.disabled = !checkFormValidity();
               question1Select.dispatchEvent(new Event('change')); // Trigger conditional display init

        }
    </script>

</body>
</html>
